app.controller('createRecipeCtrl', ['$scope', '$http', '$routeParams', 'UserServices', function($scope, $http, $routeParams, UserServices){


  
  // $http.post('/create.json').success(function(data, status, xhr){
  //   $scope.recipes = data.recipes;
  //   console.log(data);
  // });

  $scope.measurements = ["pod(s)","container(s)","packet(s)", "ounce(s)", "sheet(s)", "basket(s)", "slab(s)","dash(es)","milliliter(s)","x","shell(s)","rack(s)","quart(s)","bunch(es)","serving(s)","chunk(s)","clove(s)","liter(s)","twist(s)","gallon(s)","grind(s)","stalk(s)","tub(s)","piece(s)","pint(s)","feet","prune(s)","fluid","shot(s)","envelope(s)","gram(s)","bottle(s)","slice(s)","inch(es)","pound(s)","oz","count(s)","tray(s)","kilogram(s)","jar(s)","leaf(s)","head(s)","round(s)","whole","squeeze(s)","wedge(s)","pat(s)","spash(es)","bone(s)","pounch(es)","hank(s)","loaf(s)","large","bag(s)","spear(s)","pinch(es)","strip(s)","thin","roll(s)","medium","jumbo","bite","square(s)","cube(s)","rib(s)","sprig(s)","drop(s)","crown(s)","cup(s)","leg(s)","stick(s)","tablespoon(s)","scoop(s)","link(s)","package(s)","mini","sleeve(s)","ear(s)","bulb(s)","box(es)"].sort();

  $scope.create_parameters = {};

  // var user = UserServices;
  // $scope.create_parameters.author = UserServices.username;

  $scope.create_parameters.title = '';

  $scope.create_parameters.description = '';

  // add ingredients function
  $scope.create_parameters.all_ingredients = [];

  var checkDuplicates = function(keyword,array) {
    for (var i= 0; i < array.length; i++) {
      if (keyword == array[i]) {
        return true;
      }
    }
  };

  $scope.addIngredient = function() {
    if ($scope.newIngredName != undefined && $scope.newIngredName != "") {
      if (checkDuplicates($scope.newIngredName,$scope.create_parameters.all_ingredients) == true) {
        $scope.newIngredName = '';
      } else {
        $scope.create_parameters.all_ingredients.push({
          "amount": $scope.newIngredNumber,
          "unit": $scope.newIngredUnit,
          "name": $scope.newIngredName
        });
        $scope.newIngredNumber = '';
        $scope.newIngredUnit = '';
        $scope.newIngredName = '';
        console.log($scope.create_parameters);
      }
    } else {
      $scope.newIngredName = '';
      // needs notification of empty string
    }
  };

  $scope.removeIngredient = function(index) {
    $scope.create_parameters.all_ingredients.splice(index,1);
  };
  
   // time sliders function
  $scope.create_parameters.timeFrame = {
    "prepTime": 0,
    "cookTime": 0,
    "restTime": 0
  };

  var timeConversion = function(minutes) {
    if (minutes > 60) {
      return Math.floor(minutes / 60) + "hr " + minutes % 60 + "min";
    } else {
      return minutes + "min";
    }
  }

  $(function() {
    $("#prep-time-slider").slider({
      min: 0,
      max: 1440,
      values: [0],
      slide: function(event,ui) {
        $("#prep-time-amount").val(timeConversion(ui.values));
        $scope.create_parameters.timeframe.prepTime = ui.values;
        console.log($scope.create_parameters);
      }
    });
    // initial slider values
    $("#prep-time-amount").val(timeConversion(0));
  });

  $(function() {
    $("#cook-time-slider").slider({
      min: 0,
      max: 1440,
      values: [0],
      slide: function(event,ui) {
        $("#cook-time-amount").val(timeConversion(ui.values));
        $scope.create_parameters.timeframe.cookTime = ui.values;
        console.log($scope.create_parameters);
      }
    });
    // initial slider values
    $("#cook-time-amount").val(timeConversion(0));
  });

  $(function() {
    $("#rest-time-slider").slider({
      min: 0,
      max: 1440,
      values: [0],
      slide: function(event,ui) {
        $("#rest-time-amount").val(timeConversion(ui.values));
        $scope.create_parameters.timeframe.restTime = ui.values;
        console.log($scope.create_parameters);
      }
    });
    // initial slider values
    $("#rest-time-amount").val(timeConversion(0));
  });

    
  // add instruction functions
  $scope.create_parameters.all_instructions = [];

  $scope.addInstruction = function() {
    if ($scope.newInstruction != undefined && $scope.newInstruction != "") {
      if (checkDuplicates($scope.newInstruction,$scope.create_parameters.all_ingredients) == true) {
        $scope.newInstruction = '';
      } else {
        $scope.create_parameters.all_instructions.push($scope.newInstruction);
        $scope.newInstruction = '';
        console.log($scope.create_parameters);
      }
    } else {
      $scope.newInstruction = '';
      // needs notification of empty string
      }
    } else {
      $scope.addInstruction = '';
      // needs notification of empty string
    }
  };

  $scope.removeInstruction = function(index) {
    $scope.create_parameters.all_instructions.splice(index,1);
  };

  $scope.submitCreation = function() {
    $scope.create_parameters.author = UserServices.username;
    console.log($scope.create_parameters);
  }


}]);
