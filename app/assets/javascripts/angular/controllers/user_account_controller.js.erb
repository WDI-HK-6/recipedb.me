app.controller('UserCtrl', ['$scope', '$http', '$routeParams', 'UserServices', 'Message', '$location', function($scope, $http, $routeParams, $location, UserServices, Message){

  console.log('we are in the UserCtrl');
  $scope.user = UserServices;

// TODO: PUT ALL THAT IN THE USER SERVICE!
  $http.get("/user/any").success(function(response,status){
    console.log(response);
    UserServices.status = response.signedIn;
    UserServices.username = response.username;
    UserServices.userID = response.user_id;
  });

  $scope.userSignUp = function(){
    var data = {
      user: {
        username: $scope.signupUsername,
        email: $scope.signupEmail,
        password: $scope.signupPassword,
        password_confirmation: $scope.signupPasswordConfirm
      },
      commit: "Sign Up"
    };

    $http.post("/users/",data).success(function(response,status){
      UserServices.status = true;
      console.log(response);
      Message.sendNoty("success","Successfully Registered");
    }).error(function(response,status){
      Message.sendNoty("error","Registration Error, please try again");
    });
  };

  $scope.userSignOut = function(){
    $http.delete("/users/sign_out/").success(function(response,status){
      console.log(response);
      UserServices.resetMain();
      UserServices.resetSub();
      Message.sendNoty("success","Logged Out");
      UserServices.status = false;
      $location.path("/");
    }).error(function(response,status){
      Message.sendNoty("error","Problem with logging, please try again");
    });
  };

  $scope.userSignIn = function (){
    var data = {
      user: {
        email: $scope.loginEmail,
        password: $scope.loginPassword
      },
      commit: "Sign In"
    };

    $http.post("/users/sign_in/", data).success(function(response, status){
      Message.sendNoty("success","Logged In");
      UserServices.status = true;
    }).error(function(response,status){
      Message.sendNoty("error","Login Error, please try again");
    });
  };
}]);